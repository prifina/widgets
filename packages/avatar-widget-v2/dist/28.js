"use strict";(self.webpackChunk_prifina_widgets_avatar_widget_v2=self.webpackChunk_prifina_widgets_avatar_widget_v2||[]).push([[28],{4028:(e,t,a)=>{a.r(t);var n=a(1119),o=a(6470),i=a(513),r=(a(6781),a(5734),a(9120),a(8188),a(8233),a(7162)),s=a.n(r),c=a(7900),u=a.n(c),l=a(2734),d="q5jvWQ9MXhUnUFyotc6L2t",m=a(3280),h=a(1195),p=a(466),f=(0,h.ZP)("div").withConfig({displayName:"Container",componentId:"sc-63a22i-0"})({boxShadow:0,padding:5,borderRadius:10},(0,p.bU)({variants:{small:{height:300,width:300},medium:{height:616,width:616},mediumVertical:{height:616,width:300},mediumHorizontal:{height:300,width:616}}})),g=a(2955),w=a(9776);const v=function(e){var t=e.url,a=e.backgroundColor,n=e.cameraPosition,o=(e.onError,e.onLoading,e.ouraScore),i=(0,c.useRef)(null),r=new g.Clock,s=new g.PerspectiveCamera(25,1,6,1e3),l=new g.Scene,d=new g.Color(a||16777215),m=new g.WebGLRenderer({antialias:!0}),h=[],p=function e(){if(requestAnimationFrame(e),h.length>0)for(var t=0;t<h.length;t++)h[t].update(r.getDelta());m.render(l,s)},f=function(){s.position.set(n.x,n.y,n.z),l.background=d;var e=new g.HemisphereLight(16777215,4473924);e.position.set(0,200,0),l.add(e),(e=new g.DirectionalLight(16777215)).position.set(0,200,100),e.castShadow=!0,e.shadow.camera.top=180,e.shadow.camera.bottom=-100,e.shadow.camera.left=-120,e.shadow.camera.right=120,e=new g.DirectionalLight(16777215),l.add(e),e=new g.AmbientLight(2236962),l.add(e),void 0!==t&&(new w).load(t,(function(e){e.mixer=new g.AnimationMixer(e),e.mixer&&h.push(e.mixer),e.animations[0]&&e.mixer.clipAction(e.animations[0]).play(),e.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),console.log("object",e),l.add(e)}),(function(e){v(e)}),(function(e){y(e)})),m.setPixelRatio(window.devicePixelRatio),m.setSize(290,290),i.current.replaceChildren(m.domElement),p()},v=function(e){},y=function(e){};return(0,c.useEffect)((function(){console.log("component mounted"),f()}),[o]),console.log("should render state",o),console.log("react visor color",a),u().createElement("div",{style:{width:290,height:290,display:"flex",justifyContent:"center",alignItems:"center"},ref:i})},y=function(e){var t=(0,l.usePrifina)(),a=(t.stage,t.check,t.onUpdate),r=t.API,h=t.registerDataConnector,p=(e.score,(0,c.useState)()),g=(0,i.Z)(p,2),w=g[0],y=g[1],b=function(e){var t=e;console.log("OURA SCORE PROCESSED NEW DATA",t);var a=0,n=t.length-1;do{a=t[n].split(",")[1],n--}while(a<1&&n>0);y(a)},x=function(){var e=(0,o.Z)(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("UPDATE ",t),t.hasOwnProperty("data")&&t.data.hasOwnProperty("content")&&"Oura/queryReadinessSummariesAsync"===t.data.dataconnector&&t.data.content.length>1&&b(t.data.content);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(e){return[e.getFullYear(),(e.getMonth()+1).toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")].join("-")};(0,c.useEffect)((function(){function e(){return(e=(0,o.Z)(s().mark((function e(){var t,o,i,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(d,x),h(d,[m.Z]),t=new Date,o=t.setDate(t.getDate()-7),i=S(new Date(o)),c=(0,n.Z)({},"s3::date",(0,n.Z)({},l.Op.gte,i)),e.next=8,r[d].Oura.queryReadinessSummariesAsync({filter:c,fields:"summary_date,score"});case 8:u=e.sent,console.log("activityResult",u);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var E="https://prifina-data-352681697435-eu-west-1.s3.eu-west-1.amazonaws.com/public/ujWBeKugg514AVaE4UyaDq/native-assets/Idle.fbx",k=E,A="yellow";switch(!0){case w<=64:k="https://prifina-data-352681697435-eu-west-1.s3.eu-west-1.amazonaws.com/public/ujWBeKugg514AVaE4UyaDq/native-assets/AlertState.fbx",A="firebrick";break;case w>=65&&w<=69:k="https://prifina-data-352681697435-eu-west-1.s3.eu-west-1.amazonaws.com/public/ujWBeKugg514AVaE4UyaDq/native-assets/PayAttention.fbx",A="khaki";break;case w>=70&&w<=84:k="https://prifina-data-352681697435-eu-west-1.s3.eu-west-1.amazonaws.com/public/ujWBeKugg514AVaE4UyaDq/native-assets/WellRecovered.fbx",A="mediumseagreen";break;case w>=85:k="https://prifina-data-352681697435-eu-west-1.s3.eu-west-1.amazonaws.com/public/ujWBeKugg514AVaE4UyaDq/native-assets/SurperCharged.fbx",A="powderblue";break;default:k=E,A="gray"}return console.log("status",k),console.log("color",A),u().createElement(f,{variant:"small",style:{border:"5px solid ".concat(A),display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}},u().createElement(v,{id:"canvas",cameraPosition:{x:0,y:95,z:450},url:k,backgroundColor:A,ouraScore:w}),u().createElement("div",{style:{position:"absolute",left:25,bottom:25,fontSize:32,fontWeight:800}},w))};var b=a(953),x=document.getElementById("root");(0,b.createRoot)(x).render(u().createElement(y,null))}}]);